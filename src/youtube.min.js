/*
*
* Youtubars 1.0.1
* Copyright 2013, Pedro Rogerio
* Licensed under the WTFPL licenses (http://www.wtfpl.net/).
*
*/
Handlebars.registerHelper("duration",function(){return new Handlebars.SafeString(Youtubars.seconds2time(this.duration))}),Handlebars.registerHelper("published",function(){return new Handlebars.SafeString(moment(this.published,"YYYYMMDD").fromNow())}),Handlebars.registerHelper("description",function(){return new Handlebars.SafeString(Youtubars.truncate(this.description,170))}),Handlebars.registerHelper("viewCount",function(){return new Handlebars.SafeString(Youtubars.formatNumber(this.viewCount))});var Youtubars={init:function(a){this.url="http://gdata.youtube.com/feeds/api/videos?v=2&max-results="+a.count+"&alt=json&orderby=published&format=5&author="+a.username+"&callback=?",this.template=a.template,this.container=a.container,this.fetch()},attachTemplate:function(){var a=Handlebars.compile(this.template);this.container.empty().append(a(this.youtube))},fetch:function(){var a=this;$.getJSON(this.url,function(b){var c=b.feed,d=c.entry||[];a.youtube=$.map(d,function(a){return{image:a.media$group.media$thumbnail[1].url,title:a.media$group.media$title.$t,published:a.published.$t,viewCount:a.yt$statistics.viewCount,description:a.media$group.media$description.$t,duration:a.media$group.yt$duration.seconds,link:a.link[0].href}}),a.attachTemplate()})},seconds2time:function(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),a=a-3600*b-60*c,d="";return 0!=b&&(d=b+":"),(0!=c||""!==d)&&(c=10>c&&""!==d?"0"+c:String(c),d+=c+":"),""===d?d=a+"s":d+=10>a?"0"+a:String(a),d},formatNumber:function(a){return(""+a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,function(a){return a+"."})},truncate:function(a,b){if(a.length>b){for(b--,last=a.substr(b-1,1);" "!=last&&b>0;)b--,last=a.substr(b-1,1);last=a.substr(b-2,1),a=","==last||";"==last||":"==last?a.substr(0,b-2)+"...":"."==last||"?"==last||"!"==last?a.substr(0,b-1):a.substr(0,b-1)+"..."}return a}};